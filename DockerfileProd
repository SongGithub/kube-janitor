ARG BUILD_IMAGE=EMPTY
FROM "${BUILD_IMAGE}" as builder

RUN mkdir -p /venv && cp -r $(pipenv --venv)/lib/python3.7/site-packages/. /venv/

FROM python:3.7-alpine3.9 as prod
MAINTAINER Henning Jacobs <henning@jacobs1.de>
WORKDIR /

COPY --from=builder /venv/ /usr/local/lib/python3.7/site-packages
COPY kube_janitor /kube_janitor

ARG VERSION=dev
RUN sed -i "s/__version__ = .*/__version__ = '${VERSION}'/" /kube_janitor/__init__.py

ENTRYPOINT ["python3", "-m", "kube_janitor"]
