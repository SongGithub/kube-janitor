ARG BUILD_IMAGE=EMPTY
FROM "${BUILD_IMAGE}" as builder
RUN rm -fr /usr/local/lib/python3.7/site-packages/pip && \
    rm -fr /usr/local/lib/python3.7/site-packages/setuptools && \
    rm -fr /usr/local/lib/python3.7/site-packages/pipenv

FROM python:3.7-alpine3.9 as prod
MAINTAINER Henning Jacobs <henning@jacobs1.de>
WORKDIR /

COPY --from=builder /usr/local/lib/python3.7/site-packages /usr/local/lib/python3.7/site-packages
COPY kube_janitor /kube_janitor

ARG VERSION=dev
RUN sed -i "s/__version__ = .*/__version__ = '${VERSION}'/" /kube_janitor/__init__.py

ENTRYPOINT ["python3", "-m", "kube_janitor"]
